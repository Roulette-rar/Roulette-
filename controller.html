<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ルーレット - コントローラ</title>
<style>
body {
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
  display:flex; align-items:center; justify-content:center;
  min-height:100vh; margin:0; background:#eef2f8;
}
.wrap {
  width:420px; text-align:center; background:white;
  padding:18px; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.08);
}
input, button {
  margin:6px; padding:6px 10px; font-size:16px;
}
button {
  border:none; border-radius:6px; cursor:pointer;
  background:#3498db; color:white;
}
button:hover { background:#2980b9; }
#remainingText {margin-top:10px; font-size:16px; color:#333;}
</style>
</head>
<body>
<div class="wrap">
  <h2>コントローラ</h2>

  <!-- 次を固定するUI -->
  <div>
    <input type="number" id="forcedInput" placeholder="次に出す数字">
    <button id="setForced">次を固定</button>
  </div>

  <!-- allowed 候補を設定するUI（任意で利用可能） -->
  <div>
    <input type="text" id="allowedInput" placeholder="例: 5,7,22">
    <button id="setAllowed">候補を設定</button>
  </div>

  <!-- 残数リセット -->
  <div>
    <button id="resetRemaining">残数をリセット</button>
  </div>

  <div id="remainingText">残り: 読み込み中…</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

const firebaseConfig = { 
apiKey: "AIzaSyA1LnpXvoaTGbzQdOlAkcOPXW-8vrcnYxU",
authDomain: "roulette-7ee9d.firebaseapp.com",
databaseURL: "https://roulette-7ee9d-default-rtdb.firebaseio.com",
projectId: "roulette-7ee9d",
storageBucket: "roulette-7ee9d.firebasestorage.app",
messagingSenderId: "657226901613",
appId: "1:657226901613:web:1cceee27d98d0866223764",
measurementId: "G-576DS7K0SG" };

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const remainingRef = ref(db,'remaining');
const allowedRef   = ref(db,'allowed');
const forcedRef    = ref(db,'forcedNext');

const N = 37;

// --- 残数リセット ---
document.getElementById("resetRemaining").addEventListener("click", async () => {
  const arr = Array.from({length:N}, (_,i)=>i+1);
  await set(remainingRef, arr);
  alert("残数をリセットしました");
});

// --- 候補を設定 ---
document.getElementById("setAllowed").addEventListener("click", async () => {
  const raw = document.getElementById("allowedInput").value;
  const nums = raw.split(",").map(s => parseInt(s.trim())).filter(n => !isNaN(n));
  await set(allowedRef, nums);
  alert("候補を設定しました: " + nums.join(", "));
});

// --- 次を固定 ---
document.getElementById("setForced").addEventListener("click", async () => {
  const val = parseInt(document.getElementById("forcedInput").value);
  if (isNaN(val)) { alert("数字を入力してください"); return; }
  await set(forcedRef, val);
  alert("次の1回は " + val + " に固定しました");
});

// --- 残数表示を同期 ---
onValue(remainingRef, snap=>{
  const val = snap.val();
  const arr = Array.isArray(val)? val : Object.values(val||{}).filter(x=>x!=null);
  document.getElementById("remainingText").textContent =
    arr.length>0 ? `残り: ${arr.join(', ')}` : '残りなし';
});
</script>
</body>
</html>